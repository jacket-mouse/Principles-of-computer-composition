# CPU设计步骤

- 拟定指令系统 
	- 指令格式
	- 寻址方式
	- 指令类型
- 确定总体结构
	- 寄存器
	- ALU
	- 数据通路
- 安排时序
	- 设置时序信号
- 拟定指令流程和微命令序列
	- 列微操作时间表
	- 画流程图（寄存器传送级）
- 形成控制逻辑
# 组合逻辑设计
## 组合逻辑电路单元框图

1. CU外特性
![[Pasted image 20240106141311.png]]
2. 节拍信号
![[Pasted image 20240106141357.png]]
## 微操作的节拍安排

## 组合逻辑设计步骤
# 微程序设计
## 微程序控制的基本原理

**基本思想**
- 采用了“存储逻辑”的设计思想
    将控制器需要产生的微操作命令，以微代码的形式编成微指令，存在专门的存储器中，执行机器指令时，从该存储器中取出微指令，产生执行机器指令所需的微操作命令序列。
- 采用了“程序设计”的技术
     把一条机器指令所需要的微操作命令序列，以微指令的形式编成一段微程序，整个指令系统就编出一整套微程序，采用“顺序、转移、多分支”等程序设计的技术进行微程序的设计。
**基本原理（具体做法）**
- 若干微命令编制成一条微指令，控制实现一步微操作；
- 若干微指令组成一段微程序，解释执行一条机器指令；
- 微程序事先存放在控制存储器中，执行机器指令时再取出。
## 基本概念

微操作或微命令：构成控制信号序列的最小单位
微操作：由若干微命令控制实现的最基本操作。
微指令：若干个微命令的组合。
微周期：指从控制存储器中读取一条微指令并执行相应的微操作所需的时间。
微程序：一系列微指令的有序集合。
控制存储器：存放微程序的只读存储器。

## 微程序控制单元

**基本框图**
![[Pasted image 20240106212835.png]]
操作控制：控制信号
顺序控制：后继微指令地址
**工作原理**
![[Pasted image 20240106213039.png]]
- 取指阶段
	1. M -> CMAR（M为取指微程序首地址）
	2. CM( CMAR ) -> CMDR
	3. Ad( CMDR ) -> CMAR（由CMDR发微操作命令，形成下一条微指令地址M+1）
	4. CM( CMAR ) -> CMDR
	5. Ad( CMDR ) -> CMAR（由CMDR发微操作命令，形成下一条微指令地址M+2）
	6. CM( CMAR ) -> CMDR
- 执行阶段（LDA）
	1. OP( IR ) -> 微地址形成部件 -> CMAR
	2. CM( CMAR ) -> CMDR  P
	3. Ad( CMDR ) -> CMAR
	4. CM( CMAR ) -> CMDR  P+1
	5.  Ad( CMDR ) -> CMAR
	6. CM( CMAR ) -> CMDR  P+2
	7.  Ad( CMDR ) -> CMAR
全部微指令存在CM中，程序执行过程中只需读出。

## 微程序序列地址的形成

1. 直接由微指令的下地址字段指出（断定方式）
2. 根据机器指令的操作码形成
3. 增量计数器法 ( CMAR ) + 1 -> CMAR
4. 分支转移
	| 操作控制字段 | 转移方式 | 转移地址 |
	转移方式：指明判别条件
	转移地址：指明转移成功后的去向
5. 通过测试网络
6. 由硬件产生微程序入口地址
	1. 第一条微指令地址 由专门的硬件产生
	2. 中断周期 由硬件产生中断周期微程序首地址
**原理图**
![[Pasted image 20240106215137.png]]

**微指令后继微地址的形成方式有哪几种？对于其中的根据机器指令的操作码形成微程序入口地址的方法，请画图做出说明。**

**参考答案要点**：

1. 微指令后继微地址的形成方式主要有6种
	包括：
	1）断定方式。
	2）微地址形成部件生成。
	3）增量计数器法（增量方式）。
	4）分支转移方式。
	5）通过测试网络形成。
	6）由硬件产生微程序入口地址。

2. 根据操作码形成微程序入口地址的方法

![](file:///C:\Users\l1491\AppData\Local\Temp\ksohtml34972\wps1.png)

如上图所示，机器指令取至指令寄存器后，指令的操作码作为微地址形成部件的输入，来形成微指令的地址。因此，可以把微地址形成部件理解为一个编码器。微地址形成部件可采用PROM实现，即以指令的操作码作为PROM的地址，而相应的存储单元中就存放着对应该指令微程序的首地址。

## 微程序设计举例

